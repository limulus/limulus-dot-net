<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />

    <link
      rel="preload"
      href="/assets/fonts/mona-sans.6d7565f0.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" :href="getBundleFileUrl('css')" webc:keep />
    <link rel="stylesheet" href="../css/normalize.css" />
    <link rel="stylesheet" href="../css/main.css" />
    <link rel="stylesheet" href="../css/hljs-github.css" />

    <script webc:type="js">
      if (page.url === '/') {
        ;`<title>limulus.net</title>`
      } else {
        ;`<title>limulus.net ${page.url.replace(/\/$/, '').replaceAll('/', ' / ')}</title>`
      }
    </script>

    <link rel="alternate" type="application/atom+xml" :href="feedUrl ?? site.feedUrl" />

    <meta property="og:title" :content="title" />
    <meta property="og:type" content="website" />
    <meta property="og:url" :content="$data.site.url + page.url" />
    <meta
      webc:if="subhead || teaser"
      property="og:description"
      :content="subhead ?? teaser"
    />

    <script webc:type="js">
      const getPreviewPhoto = (id) => {
        const photo = this.$data.photos[id]
        return {
          description: photo.description,
          mime: 'image/jpeg',
          ...photo.renditions.find(
            ({ name, format }) => name === 'md' && format === 'jpeg'
          ),
        }
      }

      const render = () => {
        if (image) {
          var photo = getPreviewPhoto(image)
        } else if (hero?.type === 'pho') {
          photo = getPreviewPhoto(hero.id)
        } else if (hero?.type === 'vod') {
          if (!hero.alt) throw new Error('Missing alt text for video-on-demand hero')
          photo = {
            url: `https://vod.limulus.net/${hero.id}/poster.jpeg`,
            width: 3840,
            height: 2160,
            description: hero.alt,
          }
        } else {
          return ''
        }

        return /* HTML */ `
          <meta property="og:image" content="${photo.url}" />
          <meta property="og:image:type" content="${photo.mime}" />
          <meta property="og:image:width" content="${photo.width}" />
          <meta property="og:image:height" content="${photo.height}" />
          <meta
            property="og:image:alt"
            content="${webc.escapeAttribute(photo.description)}"
          />
        `
      }

      render()
    </script>

    <meta webc:if="subhead || teaser" name="description" :content="subhead ?? teaser" />
    <meta
      webc:if="$data.authors[author]?.fediverse"
      name="fediverse:creator"
      :content="$data.authors[author].fediverse"
    />
  </head>
  <body @raw="content"></body>
</html>
